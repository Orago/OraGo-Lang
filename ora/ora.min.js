function betterIterable(e,t={}){const{tracking:r=!1,maxStack:n=10}=t,i=[...e];e=i;let a=[];return{source:e,*[Symbol.iterator](){for(;0<i.length;)yield this.next().value},next(t=0){if("number"==typeof t)for(let e=0;e<t;e++)i.shift();return r&&(a.push(i[0]),a.length>n)&&a.shift(),{value:i.shift(),done:i.length<1}},peek(e=1){return{value:i[e-1],done:i.length<1}},clone(){return betterIterable(i,t)},push(...e){i.push(e)},size(){return i.length},test(e,t=1){t=i[t-1];return"string"==typeof e&&e==t||e instanceof Function&&!0===e(t)||e instanceof RegExp&&e.test(t)},disposeIf(e,t=1){e=this.test(e,t);return e&&this.next(t-1),e},disposeIfNot(e,t=1){e=this.test(e,t);return e||this.next(t-1),e},stringify(e=" "){return i.join(e)},stack(){return a},last(e=0){return a[a.length-1-e]}}}const typeEnforcer=(e,t)=>typeof(new e).valueOf()==typeof t&&null!==t?t:(new e).valueOf(),forceType={forceNull:e=>null,forceBoolean:e=>typeEnforcer(Boolean,e),forceNumber:e=>typeEnforcer(Number,!isNaN(e)&&Number(e)),forceBigInt:e=>typeEnforcer(BigInt,e),forceString:e=>typeEnforcer(String,e),forceObject:e=>typeEnforcer(Object,e),forceArray:e=>Array.isArray(e)?e:[]},Enum=(...e)=>Object.freeze(e.reduce((e,t,r)=>(e[t]=r,e),{})),isNum=e=>!isNaN(e),isA0=e=>null!=e&&/[a-z0-9]/i.test(e),isA_0=e=>null!=e&&/[a-z0-9_]/i.test(e),isMath=e=>/^(~\w+|[\d\s+\-*/()]+)+$/.test(e);function evalMath(r){try{var e=["+","-","*","/","^"],n={"+":1,"-":1,"*":2,"/":2,"^":3},i=[],a=[];for(let t=0;t<r.length;t++){var s=r[t];if(isNaN(parseFloat(s))&&"."!==s){if(-1!==e.indexOf(s)){for(;i.length&&-1!==e.indexOf(i[i.length-1])&&n[s]<=n[i[i.length-1]];)a.push(i.pop());i.push(s)}else if("("===s)i.push(s);else if(")"===s){for(;"("!==i[i.length-1];)a.push(i.pop());i.pop()}}else{let e=s;for(;!isNaN(parseFloat(r[t+1]))||"."===r[t+1];)e+=r[++t];a.push(parseFloat(e))}}for(;i.length;)a.push(i.pop());for(const t of a)i.push("number"==typeof t?t:((e,t,r)=>{switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"^":return Math.pow(r,t)}})(t,i.pop(),i.pop()));return i[0]}catch(e){return console.error("Error: "+e),NaN}}function oraLexer(e){var t=e.match(/(['"])(.*?)\1|\w+|(?!\\)[~!@#$%^&*{}()-_+"'\\/.;:\[\]\s]|[\uD83C-\uDBFF\uDC00-\uDFFF]+/g);if(null==t)throw"This is a blank file!";for(;-1!=t.indexOf(" ");)t.splice(t.indexOf(" "),1);return t}function chunkLexed(e){var t=[];let r=[],n=0;for(const i of e)"{"===i?(n++,r.push(i)):"}"===i?(n--,r.push(i)):";"===i?0==n?(t.push(r),r=[]):r.push(i):"\n"!==i&&"\t"!==i&&"\r"!==i&&r.push(i);return t}const strReg=/(['"])(.*?)\1/,isString=e=>strReg.test(e),parseString=e=>strReg.exec(e)?.[2];function parseInputToVariable(o,e,u={},f=!0){const l=this["parseInput"];var{variables:t={}}=u,e=e["value"];const c=({source:e,property:t})=>{let r=null!=t?e[t]:e;var n="class"===r?.prototype?.constructor?.toString()?.substring(0,5);if(n||"function"!=typeof r||(r=r.bind(e)),o.disposeIf("BIND"))if("function"!=typeof r||n){if("object"==typeof r)if(o.disposeIf("(")){var i=[];let e=0;for(;!o.disposeIf(")");)if(!o.disposeIf(",")){if(i.push(l(o,o.next(),u)),100<e++)return console.error(new Error("Cannot run more than 100 args on a function"));if(null==o.peek(1).value)break}r=Object.assign(r,...i)}else{var a=forceType.forceObject(l(o,o.next(),u,!1));r=Object.assign(r,a)}}else{a=forceType.forceObject(l(o,o.next(),u));r=r.bind(a)}if(o.disposeIf(".")&&o.disposeIf(isA_0))return c({source:r,property:o.last()});if(o.disposeIf("=")){if(null==t)throw"Cannot mod a raw variable to a value!";return e[t]=l(o,o.next(),u),e}if(f&&o.disposeIf("(")){if("function"==typeof r||n){var s=[];let e=0;for(;!o.disposeIf(")");)if(!o.disposeIf(",")){if(s.push(l(o,o.next(),u)),100<e++)return console.error(new Error("Cannot run more than 100 args on a function"));if(null==o.peek(1).value)break}a=n?new r(...s):r(...s);return c({source:a})}console.error("Cannot call function on non-function",t,"\n",o.stack())}else if(null!=r)return r?.hasOwnProperty("value")?r.value:r};return c({property:e,source:t})}const setOnPath=({value:e,path:t,data:r})=>{for(const i of t.slice(0,t.length-1))"object"!=typeof r[i]&&(r[i]={value:r[i]}),null==r[i].value&&delete r[i].value,r=r[i];var n=1<t.length?t.length-1:0;null!=e?r[t[n]]=e:delete r[t[n]]};function expectSetVar({iter:e,data:t}){for(var r=forceType.forceArray(parseInput(e.clone(),e.peek(1),t)),n=e.next().value,i=[n];e.disposeIf(".")&&isA_0(e.peek(1).value);)i.push(e.next().value);if(t.functions.hasOwnProperty(n))throw"Cannot set variable to function name: "+n;return{name:n,path:i,data:r}}const parseBlock=({iter:e})=>{var t=[];if(!e.disposeIf("{"))throw new Error("Missing Opening '{' after parameters");let r=1,n=0;for(const i of e)if("{"===i?r++:"}"===i&&n++,"\r"!=i&&(t.push(i),r==n)&&0<r)break;if("}"!==t[t.length-1])throw new Error("Missing Closing '}' at end of function");return t.pop(),t},keywordDict=e=>{const r={comment:["COMMENT"],set:["SET","LET"],assign:["TO","="],delete:["DELETE"],print:["PRINT"],loop:["LOOP"],for:["FOR"],if:["IF"],equals:["EQUALS"],return:["RETURN"],class:["CLASS"],function:["FUNCTION"],exit:["EXIT"],push:["PUSH"],pop:["POP"],shift:["SHIFT"],await:["AWAIT"],sleep:["SLEEP"],and:["AND","&"],from:["FROM"],bind:["BIND"],add:["+"],subtract:["-"],multiply:["*"],divide:["/"],number:["NUMBER"],string:["STRING"],boolean:["BOOLEAN"],object:["OBJECT"],array:["ARRAY"],enum:["ENUM"],true:["TRUE"],false:["FALSE"],null:["NULL"],undefined:["UNDEFINED"],NaN:["NAN"],Infinity:["INFINITY"],negativeInfinity:["NEGATIVE_INFINITY"],...e},n=Enum(...Object.keys(r));const i=t=>{var e=Object.entries(r).find(([,e])=>e.includes(t));return null!=e?n[e[0]]:null};return{id:n,match:t=>{var e=Object.entries(r).find(([,e])=>e.includes(t));if(null==e)throw new Error(`Keyword ${t} not found in dictionary`);return n[e[0]]},matchUnsafe:i,has:t=>Object.values(r).some(e=>e.includes(t)),is:(e,t)=>i(e)===t}};class Ora{variables;classes;functions;utils={setOnPath:setOnPath,chunkLexed:chunkLexed,isA_0:isA_0,isNum:isNum,forceType:forceType,evalMath:evalMath,expectSetVar:expectSetVar};constructor(e={}){var{customFunctions:e,customClasses:t,overrideFunctions:r,overrideDictionary:n,functionGenerator:i}=forceType.forceObject(e);this.settings={},this.utils.parseInput=this.parseInput,this.init({functions:e,classes:t,overrideFunctions:r,overrideDictionary:n,functionGenerator:i})}init({functions:e,classes:t,overrideFunctions:r,overrideDictionary:n,functionGenerator:i}){this.keywords=keywordDict(n),"function"==typeof i&&"object"==typeof(n=i(this))&&null!==n&&(e={...e,...n}),this.variables={},this.classes={...forceType.forceObject(t)};const{keywords:a,parseInput:l}=this;this.functions={...forceType.forceObject(e),[a.id.comment]:()=>({break:!0}),[a.id.set]:({iter:e,data:t})=>{var r=(e.disposeIf(e=>a.is(e,a.id.global))?this:t)["variables"],n=[e.next().value];if(t.functions.hasOwnProperty(n[0]))throw"Cannot set variable to function name: "+n[0];for(;e.disposeIf(".")&&isA_0(e.peek(1).value);)n.push(e.next().value);var i=e.next();if(!isA_0(n[0])||i.done||!a.is(i.value,a.id.assign))throw`Invalid Variable Name: (${n[0]}), or next sequence (${i.value})`;setOnPath({data:r,path:n,value:l(e,e.next(),t)})},[a.id.delete]({iter:e,data:t}){var r=(e.disposeIf(e=>a.is(e,a.id.global))?this:t).variables,n=[e.next().value];if(t.functions.hasOwnProperty(n[0]))throw"Cannot set variable to function name: "+n[0];for(;e.disposeIf(".")&&isA_0(e.peek(1).value);)n.push(e.next().value);if(!isA_0(n[0]))throw`Invalid Variable Name: (${n[0]})`;setOnPath({data:r,path:n})},[a.id.print]({iter:e,data:t}){var r=e.next();if(r.value){for(var n=[l(e,r,t)];e.disposeIf(e=>a.is(e,a.id.and))&&!e.peek().done;){var i=l(e,e.next(),t);n.push(i)}0<n.length&&console.log(...n)}},[a.id.loop]:({iter:e,handleItems:t})=>{var r=e.next().value,n=[...e];if(isNaN(r))throw"Cannot Find Loop Status";var i=forceType.forceNumber(r);for(let e=0;e<i;e++)t(betterIterable(n,{tracking:!0}),this)},[a.id.for]({iter:e,data:t,handleItems:r,maxCalls:n=100}){var i=e.next(),a=[...e];let s=0;for(;val=1==l(e,i,t);){if(s++>=n)return console.log("Call Stack Exceeded Maximum Amount");r(betterIterable(a,{tracking:!0}))}},async[a.id.if]({iter:e,data:t,handleItems:r}){if(e.disposeIf("(")){for(var n=[l(e,e.next(),t,!0)];e.disposeIf(e=>a.is(e,a.id.and))&&isA_0(e.peek().value);)n.push(l(e,e.next(),t,!0));if(!e.disposeIf(")"))throw new Error('Expected ")" to close BIND statement!');if(n.some(e=>1!=e))return}await r(betterIterable(parseBlock({iter:e,data:t}),{tracking:!0}),t)},[a.id.return]:({iter:e,data:t})=>l(e,e.next(),t),[a.id.class]({iter:e,data:t}){var r=e.next().value,n=[];for(const i of e)n.push(i);isA_0(r)&&(t.classes[r]={items:n,data:t})},[a.id.function]({iter:t,data:s,handleItems:o}){for(var e=[t.next().value];t.disposeIf(".")&&isA_0(t.peek(1).value);)e.push(t.next().value);const u=[];if(t.disposeIf("(")){let e=0;for(;!t.disposeIf(")");)if((!t.disposeIf(",")||!t.disposeIfNot(isA_0))&&(u.push(t.next().value),100<e++))return console.error(new Error("Cannot add more than 100 args on a function"))}const f=parseBlock({iter:t,data:s});setOnPath({data:s.variables,path:e,value:async(...e)=>{var t,r,n,i,a={};for([t,r]of Object.entries(s.variables))a[t]=r;for([n,i]of Object.entries(u))["object","function"].includes(typeof e[n])?a[i]=e[n]:a[i]=l(betterIterable([],{tracking:!0}),{value:e[n]},s);return o(betterIterable(f,{tracking:!0}),{functions:s.functions,variables:a})}})},[a.id.exit]:()=>process.exit(),[a.id.push]({iter:e,data:t}){for(var r=[l(e,e.next(),t)];e.disposeIf(",")&&null!=l(e.clone(),e.peek(1),t);)r.push(l(e,e.next(),t));var n,i=e.next();!i.done&&a.is(i.value,a.id.assign)&&isA_0(e.peek(1).value)&&(i=expectSetVar({iter:e,data:t}),n=(e.disposeIf(e=>a.is(e,a.id.global))?this:t)["variables"],setOnPath({data:n,path:i.path,value:[...i.data,...r]}))},[a.id.shift]({iter:e,data:t}){expectSetVar({iter:e,data:t}).data.shift()},[a.id.pop]({iter:e,data:t}){expectSetVar({iter:e,data:t}).data.pop()},[a.id.await]:async({iter:e,data:t})=>l(e,e.next(),t),async[a.id.sleep]({iter:e,data:t}){const r=l(e,e.next(),t);return new Promise(e=>setTimeout(e,r))},...forceType.forceObject(r)},delete this.init}includesFunction(t){return null!=this.dictionary.find(e=>e[0].includes(t))}handleItems=async(e,t=this)=>{var{functions:r,variables:n}=t;for(const a of e)if(this.keywords.has(a)&&r.hasOwnProperty(this.keywords.match(a))){var i=await r[this.keywords.match(a)]({iter:e,data:t,handleItems:this.handleItems.bind(this)});if(1==i?.break)break;if(i)return i}else n?.hasOwnProperty(a)&&await this.parseInput(e,{value:a},t)};parseInput=(p,e,d={})=>{const{variables:h={}}=d,v=this["keywords"],b={[v.id.add]:"+",[v.id.subtract]:"-",[v.id.multiply]:"*",[v.id.divide]:"/"},I=t=>{if(v.is(t,v.id.true))return!0;if(v.is(t,v.id.false))return!1;if(v.is(t,v.id.object))return{};if(v.is(t,v.id.array))return[];if(v.is(t,v.id.null))return null;if(!v.is(t,v.id.undefined)){if(v.is(t,v.id.nan))return NaN;if(v.is(t,v.id.Infinity))return 1/0;if(v.is(t,v.id.negativeInfinity))return-1/0;if("{"==t){var r={};let e=0;for(;!p.disposeIf("}");){if(1e3<e++)throw new Error("Cannot parse more than 1000 items in an object");if(!p.disposeIf(",")||!p.disposeIfNot(isA_0)){var n=p.next();if(null==n.value)break;if(!p.disposeIf(":"))throw new Error('Expected ":" after key');r[n.value]=I(p.next().value)}}return parseInputToVariable.bind(this)(p,{},{variables:r})}if("["==t){var i=[];let e=0;for(;!p.disposeIf("]");){if(1e3<e++)throw new Error("Cannot parse more than 1000 items in an array");if(!p.disposeIf(",")||!p.disposeIfNot(isA_0)){var a=p.next();if(null==a.value)break;i.push(I(a.value))}}return i}if(isString(t)){let e=parseString(t);for(;p.disposeIf(e=>v.is(e,v.id.add))&&null!=p.peek(1).value;)e=e.concat(I(p.next().value));return e}if(v.is(t,v.id.enum)){if(!p.disposeIf("{"))throw new Error('Expected "{" after ENUM');var s=[];let e=0;for(;!p.disposeIf("}");){if(1e3<e++)throw new Error("Cannot parse more than 1000 items in an enum");if(!p.disposeIf(e=>v.is(e,v.id.and))||!p.disposeIfNot(isA_0)){var o=p.next();if(null==o.value)break;s.push(I(o.value))}}return Enum(...s)}let e;if(isA_0(t)&&h.hasOwnProperty(t)&&(e=parseInputToVariable.bind(this)(p,{value:t},d)),!isNaN(t)||"number"==typeof e){var u=forceType.forceNumber(isNum(t)?t:e);if(null!=u){let e=u+"";for(;b.hasOwnProperty(v.matchUnsafe(p.peek().value));){var f,l=b[v.matchUnsafe(p.next().value)],c=p.next().value;isNaN(c)&&!isA_0(c)||(f=parseInputToVariable(p,{value:c},d),c=forceType.forceNumber(isNum(c)?c:f),e+=` ${l} `+c)}return evalMath(e)}}return"CURRENT_DATE"===t?Date.now():e}};e=I(e.value);return p.disposeIf(e=>v.is(e,v.id.equals))?e==I(p.next.value):e};async run(e){for(const r of chunkLexed(oraLexer(e))){var t=await this.handleItems(betterIterable(r,{tracking:!0}));if(1==t?.exit)return t?.value}return this}}module.exports=Ora;